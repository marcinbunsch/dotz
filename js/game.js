!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},o={},i=function(t,e){return{}.hasOwnProperty.call(t,e)},r=function(t,e){var o,i,r=[];o=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var s=0,n=o.length;n>s;s++)i=o[s],".."===i?r.pop():"."!==i&&""!==i&&r.push(i);return r.join("/")},s=function(t){return t.split("/").slice(0,-1).join("/")},n=function(e){return function(o){var i=s(e),n=r(i,o);return t.require(n,e)}},h=function(t,e){var i={id:t,exports:{}};return o[t]=i,e(i.exports,n(t),i),i.exports},u=function(t,s){var n=r(t,".");if(null==s&&(s="/"),i(o,n))return o[n].exports;if(i(e,n))return h(n,e[n]);var u=r(n,"./index");if(i(o,u))return o[u].exports;if(i(e,u))return h(u,e[u]);throw new Error('Cannot find module "'+t+'" from "'+s+'"')},a=function(t,o){if("object"==typeof t)for(var r in t)i(t,r)&&(e[r]=t[r]);else e[t]=o},d=function(){var t=[];for(var o in e)i(e,o)&&t.push(o);return t};t.require=u,t.require.define=a,t.require.register=a,t.require.list=d,t.require.brunch=!0}}(),require.register("colors",function(t,e,o){var i,r,s;i={green:"#77c299",blue:"#708dbf",purple:"#a5547d",red:"#e84f5e",yellow:"#fece58"},s=[];for(r in i)s.push(r);i.names=s,i.count=i.names.length,i.random=function(){var t,e;return t=Math.floor(Math.random()*i.count),e=i.names[t],i[e]},o.exports=i}),require.register("dot",function(t,e,o){var i,r,s,n,h=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};i=e("colors"),s=e("entity"),n=e("move"),r=function(t){function e(t,o){null==o&&(o={}),this.adjacentTo=h(this.adjacentTo,this),this.getColumn=h(this.getColumn,this),this.getRow=h(this.getRow,this),this.getMiddleY=h(this.getMiddleY,this),this.getMiddleX=h(this.getMiddleX,this),this.onMouseOver=h(this.onMouseOver,this),this.onMouseDown=h(this.onMouseDown,this),this.dotDiv=h(this.dotDiv,this),this.createEntity=h(this.createEntity,this),this.destroy=h(this.destroy,this),this.draw=h(this.draw,this),this.game=t,this.color=o.color||i.random(),this.row=o.row,this.column=o.column,this.id=e.getId()}return a(e,t),e.WIDTH=20,e.HEIGHT=20,e.RADIUS=36,e.RADIUS_HALF=e.RADIUS/2,e.RADIUS_QUARTER=e.RADIUS/4,e.lastId=0,e.getId=function(){return this.lastId+=1},e.prototype.draw=function(){return this.entity=this.createEntity(),this.entity.bind("MouseDown",this.onMouseDown),this.entity.bind("MouseOver",this.onMouseOver)},e.prototype.destroy=function(){return this.entity.destroy(),this.game=null},e.prototype.createEntity=function(){var t,e;return t=this.column*s.WIDTH,e=this.row*s.WIDTH,this.entity=Crafty.e("Dot, Mouse, Platform, 2D, HTML, DOM, Color, Collision, Gravity").gravity("Platform").gravityConst(2.5).append(this.dotDiv()).attr({x:t,y:e,w:s.WIDTH,h:s.WIDTH})},e.prototype.dotDiv=function(){return"<div style='height: "+e.RADIUS+"px; width: "+e.RADIUS+"px; margin-left: "+(s.WIDTH_HALF-e.RADIUS_HALF)+"px;  margin-top: "+(s.WIDTH_HALF-e.RADIUS_HALF)+"px;background-color: "+this.color+"; border-radius: "+e.RADIUS+"px'></div>"},e.prototype.onMouseDown=function(t){return t.preventDefault(),this.game.move=new n(this.game),this.game.move.addDot(this)},e.prototype.onMouseOver=function(){return this.game.move?this.game.move.addDot(this):void 0},e.prototype.getMiddleX=function(){return this.entity._x+s.WIDTH_HALF},e.prototype.getMiddleY=function(){return this.entity._y+s.WIDTH_HALF},e.prototype.getRow=function(){return this.entity._x/s.WIDTH},e.prototype.getColumn=function(){return this.entity._y/s.WIDTH},e.prototype.adjacentTo=function(t){var e,o,i,r;return o=this.getRow(),e=this.getColumn(),r=t.getRow(),i=t.getColumn(),o===r?i+1>=e&&e>=i-1:e===i?r+1>=o&&o>=r-1:void 0},e}(s),o.exports=r}),require.register("entity",function(t,e,o){var i;i=function(){function t(){}return t.WIDTH=80,t.WIDTH_HALF=t.WIDTH/2,t.HEIGHT=t.WIDTH,t.HEIGHT_HALF=t.HEIGHT/2,t}(),o.exports=i}),require.register("game",function(t,e,o){var i,r,s,n,h,u,a=function(t,e){return function(){return t.apply(e,arguments)}};i=e("colors"),r=e("dot"),h=e("level"),s=e("entity"),u=e("popup"),Crafty.c("Platform"),n=function(){function t(t,e){null==e&&(e={}),this.removeDot=a(this.removeDot,this),this.addDotAt=a(this.addDotAt,this),this.drawDots=a(this.drawDots,this),this.drawPlatform=a(this.drawPlatform,this),this.initGameArea=a(this.initGameArea,this),this.windowHeight=a(this.windowHeight,this),this.updateScore=a(this.updateScore,this),this.updateMoveCounter=a(this.updateMoveCounter,this),this.subtractMove=a(this.subtractMove,this),this.addPoints=a(this.addPoints,this),this.start=a(this.start,this),this.dispose=a(this.dispose,this),this.container=t,this.level=e.level||new h,this.score=0,this.moves=this.level.moves,this.dots=[]}return t.WIDTH=640,t.currentGame=null,t.startNewGame=function(){var e,o,i;return u.hide(),t.currentGame&&t.currentGame.dispose(),$("#start-screen").hide(),e=$("#game-screen"),e.show(),i=e.find("#game").get(0),o=new t(i),t.currentGame=o,o.start()},t.prototype.dispose=function(){return this.level=null,this.container=null},t.prototype.start=function(){return this.initGameArea(),this.drawPlatform(),this.drawDots(),this.updateMoveCounter(),this.updateScore()},t.prototype.addPoints=function(t){return this.score+=t,this.updateScore()},t.prototype.subtractMove=function(){return this.moves-=1,this.updateMoveCounter(),0===this.moves?u.show(this.score):void 0},t.prototype.updateMoveCounter=function(){return $(".limitation .count").text(this.moves)},t.prototype.updateScore=function(){return $(".score .count").text(this.score)},t.prototype.windowHeight=function(){return $(window).height()},t.prototype.initGameArea=function(){return Crafty("*").each(function(){return this.destroy()}),Crafty.initialized?void 0:(Crafty.init(t.WIDTH,this.windowHeight(),this.container),Crafty.background("rgb(255, 255, 255)"),Crafty.initialized=!0)},t.prototype.drawPlatform=function(){var e,o;return o=this.windowHeight()/2+this.level.height*s.HEIGHT/2,e=Crafty.e("Platform, 2D, DOM, Color, Collision"),e.color("#fff"),e.attr({x:0,y:o,w:t.WIDTH,h:1})},t.prototype.drawDots=function(){var t,e,o,i,r;for(r=[],e=o=0,i=this.level.height;i>=0?i>o:o>i;e=i>=0?++o:--o)r.push(function(){var o,i,r;for(r=[],t=o=0,i=this.level.width;i>=0?i>o:o>i;t=i>=0?++o:--o)r.push(this.addDotAt(e,t));return r}.call(this));return r},t.prototype.addDotAt=function(t,e){var o;return o=new r(this,{row:t-1,column:e}),o.draw(),this.dots.push(o)},t.prototype.removeDot=function(t){var e;return e=this.dots.indexOf(t),this.dots.splice(e,1),t.destroy()},t}(),o.exports=n}),require.register("initialize",function(t,e){var o,i;i=e("game"),o=e("colors"),$("a.button").css({"background-color":o.random()}),$(".start a").click(i.startNewGame)}),require.register("level",function(t,e,o){var i;i=function(){function t(){}return t.prototype.width=8,t.prototype.height=6,t.prototype.moves=20,t}(),o.exports=i}),require.register("line",function(t,e,o){var i,r,s=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,h=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};i=e("entity"),r=function(t){function e(t){null==t&&(t={}),this.drawToLocation=s(this.drawToLocation,this),this.onMouseMove=s(this.onMouseMove,this),this.createEntity=s(this.createEntity,this),this.draw=s(this.draw,this),this.detachFromMouse=s(this.detachFromMouse,this),this.attachToMouse=s(this.attachToMouse,this),this.destroy=s(this.destroy,this),this.startPoint={x:t.x||300,y:t.y||300},this.color=t.color,this.movesWithMouse=t.movesWithMouse,this.onComplete=t.onComplete||function(){},this.offset=$(Crafty.stage.elem).offset()}return h(e,t),e.HEIGHT=10,e.HEIGHT_HALF=e.HEIGHT/2,e.prototype.destroy=function(){return this.onComplete(),this.entity.destroy(),this.entity=null,this.offset=null,this.detachFromMouse()},e.prototype.attachToMouse=function(){return Crafty.addEvent(this,Crafty.stage.elem,"mousemove",this.onMouseMove),this.movesWithMouse=!0},e.prototype.detachFromMouse=function(){return Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this.onMouseMove),this.movesWithMouse=!1},e.prototype.draw=function(){return this.entity=this.createEntity(),this.movesWithMouse?this.attachToMouse():void 0},e.prototype.createEntity=function(){return Crafty.e("Line, Mouse, 2D, DOM, Color").color(this.color).origin(0,e.HEIGHT_HALF).attr({x:this.startPoint.x,y:this.startPoint.y-e.HEIGHT_HALF,w:0,h:e.HEIGHT})},e.prototype.onMouseMove=function(t){var e,o;return e=t.x-this.offset.left,o=t.y-this.offset.top+$(window).scrollTop(),this.drawToLocation(e,o)},e.prototype.drawToLocation=function(t,e){var o,i,r,s,n;return i=t-this.startPoint.x,r=e-this.startPoint.y,n=Math.pow(i,2)+Math.pow(r,2),s=Math.sqrt(n),o=180*Math.atan2(r,i)/Math.PI,this.entity.attr({w:s,rotation:o})},e}(i),o.exports=r}),require.register("move",function(t,e,o){var i,r,s=function(t,e){return function(){return t.apply(e,arguments)}};i=e("line"),r=function(){function t(t){this.addFreshDot=s(this.addFreshDot,this),this.areDotsConnected=s(this.areDotsConnected,this),this.disconnectDots=s(this.disconnectDots,this),this.connectDots=s(this.connectDots,this),this.getPreviousLine=s(this.getPreviousLine,this),this.removeCurrentLine=s(this.removeCurrentLine,this),this.getCurrentLine=s(this.getCurrentLine,this),this.getPreviousDot=s(this.getPreviousDot,this),this.removeCurrentDot=s(this.removeCurrentDot,this),this.getCurrentDot=s(this.getCurrentDot,this),this.backtrack=s(this.backtrack,this),this.addNextDot=s(this.addNextDot,this),this.addFirstDot=s(this.addFirstDot,this),this.addDot=s(this.addDot,this),this.destroyAllLines=s(this.destroyAllLines,this),this.getUniqueDotCount=s(this.getUniqueDotCount,this),this.getGroupedDots=s(this.getGroupedDots,this),this.getUniqueDots=s(this.getUniqueDots,this),this.removeDot=s(this.removeDot,this),this.addReplacementDot=s(this.addReplacementDot,this),this.destroyDots=s(this.destroyDots,this),this.dispose=s(this.dispose,this),this.updateGameState=s(this.updateGameState,this),this.addAllSameColoredDots=s(this.addAllSameColoredDots,this),this.squarePresent=s(this.squarePresent,this),this.complete=s(this.complete,this),this.game=t,this.dots=[],this.lines=[],this.connections={},this.color=null,Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this.complete)}return t.prototype.complete=function(){return Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this.complete),this.squarePresent()&&this.addAllSameColoredDots(),this.destroyDots(),this.destroyAllLines(),this.updateGameState(),this.dispose()},t.prototype.squarePresent=function(){var t,e,o;e=this.getGroupedDots();for(o in e)if(t=e[o],t.length>1)return!0;return!1},t.prototype.addAllSameColoredDots=function(){var t;return t=this.getUniqueDots(),this.game.dots.forEach(function(e){return function(o){return o.color!==e.color||t[o.id]?void 0:e.dots.push(o)}}(this))},t.prototype.updateGameState=function(){var t;return this.dots.length>1?(t=this.getUniqueDotCount(),this.game.addPoints(10*t),this.game.subtractMove()):void 0},t.prototype.dispose=function(){return this.game.move=null,this.lines=null,this.dots=null,this.connections=null},t.prototype.destroyDots=function(){var t,e,o,i,r,s;if(this.dots.length>1){r=[],s=this.getUniqueDots(),i={};for(o in s)e=s[o],t=e.column,i[t]||(i[t]=0),i[t]+=1,this.removeDot(e),r.push({column:t,iterator:i[t]});return r.forEach(function(t){return function(e){return t.addReplacementDot(e.column,e.iterator)}}(this))}},t.prototype.addReplacementDot=function(t,e){return this.game.addDotAt(-e,t)},t.prototype.removeDot=function(t){return this.game.removeDot(t)},t.prototype.getUniqueDots=function(){var t,e,o,i;o={},i=this.dots;for(e in i)t=i[e],o[t.id]=t;return o},t.prototype.getGroupedDots=function(){var t,e,o,i,r;o={},r=this.dots;for(e in r)t=r[e],o[i=t.id]||(o[i]=[]),o[t.id].push(t);return o},t.prototype.getUniqueDotCount=function(){var t,e,o,i;i=this.getUniqueDots(),t=0;for(o in i)e=i[o],t++;return t},t.prototype.destroyAllLines=function(){var t,e,o,i,r;for(i=this.lines,r=[],e=0,o=i.length;o>e;e++)t=i[e],r.push(t.destroy());return r},t.prototype.addDot=function(t){return 0===this.dots.length?this.addFirstDot(t):this.addNextDot(t)},t.prototype.addFirstDot=function(t){return this.color=t.color,this.addFreshDot(t)},t.prototype.addNextDot=function(t){var e,o,i;if(t.color===this.color&&(e=this.getCurrentDot(),t.id!==e.id&&t.adjacentTo(e))){if(i=this.getPreviousDot(),i&&i.id===t.id)return this.backtrack();if(!this.areDotsConnected(t,e))return o=this.getCurrentLine(),o.drawToLocation(t.getMiddleX(),t.getMiddleY()),o.detachFromMouse(),this.connectDots(t,e),this.addFreshDot(t)}},t.prototype.backtrack=function(){var t,e,o,i;return o=this.getPreviousDot(),i=this.getPreviousLine(),t=this.removeCurrentDot(),e=this.removeCurrentLine(),e.destroy(),i.attachToMouse(),this.disconnectDots(o,t)},t.prototype.getCurrentDot=function(){return this.dots[this.dots.length-1]},t.prototype.removeCurrentDot=function(){return this.dots.pop()},t.prototype.getPreviousDot=function(){return this.dots[this.dots.length-2]},t.prototype.getCurrentLine=function(){return this.lines[this.lines.length-1]},t.prototype.removeCurrentLine=function(){return this.lines.pop()},t.prototype.getPreviousLine=function(){return this.lines[this.lines.length-2]},t.prototype.connectDots=function(t,e){var o,i,r,s;return s=[t.id,e.id].sort(),i=s[0],o=s[1],(r=this.connections)[i]||(r[i]={}),this.connections[i][o]=!0},t.prototype.disconnectDots=function(t,e){var o,i,r,s;return s=[t.id,e.id].sort(),i=s[0],o=s[1],(r=this.connections)[i]||(r[i]={}),delete this.connections[i][o]},t.prototype.areDotsConnected=function(t,e){var o,i,r;return r=[t.id,e.id].sort(),i=r[0],o=r[1],this.connections[i]&&this.connections[i][o]},t.prototype.addFreshDot=function(t){var e;return e=new i({color:this.color,x:t.getMiddleX(),y:t.getMiddleY(),movesWithMouse:!0}),e.draw(),this.lines.push(e),this.dots.push(t)},t}(),o.exports=r}),require.register("popup",function(t,e,o){var i;i={},i.show=function(t){return $(".popup .result").text(t),$(".popup").show(),$(".popup-background").show()},i.hide=function(){return $(".popup").hide(),$(".popup-background").hide()},o.exports=i});